(function(){angular.module("yboxApp",["ngRoute","ngSanitize"]);function e(e,t){e.when("/",{templateUrl:"/views/home.view.html",controller:"homeCtrl",controllerAs:"vm"}).when("/article/:articleid",{templateUrl:"/views/articleDetail.view.html",controller:"articleDetailCtrl",controllerAs:"vm"}).when("/category/:categoryid/articles",{templateUrl:"/views/home.view.html",controller:"categoryArticles",controllerAs:"vm"}).when("/newarticle",{templateUrl:"/views/newarticle.view.html",controller:"newArticleCtrl",controllerAs:"vm"}).when("/register",{templateUrl:"/views/register.view.html",controller:"registerCtrl",controllerAs:"vm"}).when("/login",{templateUrl:"/views/login.view.html",controller:"loginCtrl",controllerAs:"vm"}).otherwise({redirectTo:"/"});t.html5Mode(true)}angular.module("yboxApp").config(["$routeProvider","$locationProvider",e])})();(function(){angular.module("yboxApp").controller("homeCtrl",e);e.$inject=["articles","$routeParams"];function e(e,t){var r=this;r.rightContent="Feature and Advertising posts goes here";r.message="Loading article";var o=1;if(t.page){o=t.page}r.currentPage=o;var n=5;r.link="/";e.getAll(n,o).success(function(e){r.message=e.length>0?"":"No articles found";r.data={articles:e}}).error(function(e){r.message="Sorry, something's gone wrong"});e.getArticlesNumber("").success(function(e){r.pages=[];var t=Math.ceil(e/n);for(var o=1;o<=t;o++){r.pages.push(o)}}).error(function(e){console.log(e)})}})();(function(){angular.module("yboxApp").service("articles",e);e.$inject=["$http","authentication"];function e(e,t){this.getAll=function(t,r){return e.get("/api/articles?limit="+t+"&page="+r)};this.addArticle=function(r){return e.post("/api/articles",r,{headers:{Authorization:"Bearer "+t.getToken()}})};this.getArticleById=function(t){return e.get("/api/articles/"+t)};this.getArticlesNumber=function(t){return e.get("/api/articlescount?category_id="+t)}}})();(function(){angular.module("yboxApp").service("categories",e);e.$inject=["$http"];function e(e){this.getAll=function(){return e.get("/api/categories")};this.articles=function(t,r,o){return e.get("/api/categories/"+t+"/articles?limit="+r+"&page="+o)};this.getArticlesNumber=function(t){return e.get("/api/articlescount?category_id="+t)}}})();(function(){angular.module("yboxApp").service("authentication",e);e.$inject=["$window","$http"];function e(e,t){var r=this;r.saveToken=function(t){e.localStorage["ybox-token"]=t};r.getToken=function(){return e.localStorage["ybox-token"]};r.register=function(e){return t.post("/api/register",e).success(function(e){r.saveToken(e.token)})};r.login=function(e){return t.post("/api/login",e).success(function(e){r.saveToken(e.token)})};r.logout=function(){e.localStorage.removeItem("ybox-token")};r.isLoggedIn=function(){var t=r.getToken();if(t){var o=JSON.parse(e.atob(t.split(".")[1]));return o.exp>Date.now()/1e3}else{return false}};r.currentUser=function(){if(r.isLoggedIn()){var t=r.getToken();var o=JSON.parse(e.atob(t.split(".")[1]));return{email:o.email,name:o.name}}}}})();(function(){angular.module("yboxApp").directive("footerGeneric",e);function e(){return{restrict:"EA",templateUrl:"/common/directives/footerGeneric/footerGeneric.template.html"}}})();(function(){angular.module("yboxApp").directive("navigation",e);function e(){return{restrict:"EA",templateUrl:"/common/directives/navigation/navigation.template.html",controller:"navigationCtrl as navvm"}}})();(function(){angular.module("yboxApp").controller("navigationCtrl",e);e.$inject=["$location","authentication","$rootScope"];function e(e,t,r){var o=this;r.currentPath=e.path();r.isLoggedIn=t.isLoggedIn();r.currentUser=t.currentUser();o.logout=function(){t.logout();e.path("/");r.isLoggedIn=t.isLoggedIn();r.currentUser=t.currentUser()}}})();(function(){angular.module("yboxApp").directive("pageHeader",e);function e(){return{restrict:"EA",scope:{data:"=content"},templateUrl:"/common/directives/pageHeader/pageHeader.template.html"}}})();(function(){angular.module("yboxApp").controller("articleDetailCtrl",t);t.$inject=["$routeParams","articles","categories"];function t(t,r,o){var n=this;n.articleid=t.articleid;r.getArticleById(n.articleid).success(function(t){n.article=t;o.articles(t.category_id,4,1).success(function(e){n.relatedArticles=e.filter(function(e){return e._id!=n.articleid})}).error(function(t){console.log(e)})}).error(function(t){console.log(e)})}})();(function(){angular.module("yboxApp").controller("categoryArticles",e);e.$inject=["categories","$routeParams"];function e(e,t){var r=this;r.rightContent="Feature and Advertising posts goes here";r.message="Loading article";var o=t.categoryid;r.articles=[];var n=5;var i=1;r.link="/category/"+o+"/articles";if(t.page){i=t.page}r.currentPage=i;e.getArticlesNumber(o).success(function(e){r.pages=[];var t=Math.ceil(e/n);for(var o=1;o<=t;o++){r.pages.push(o)}}).error(function(e){console.log(e)});e.articles(o,n,i).success(function(e){r.message=e.length>0?"":"No articles found";r.data={articles:e}}).error(function(e){r.message="Sorry, something's gone wrong"})}})();(function(){angular.module("yboxApp").controller("newArticleCtrl",t);t.$inject=["categories","articles","$location","authentication"];function t(t,r,o,n){if(n.isLoggedIn()){var i=this;t.getAll().success(function(e){i.categories=e}).error(function(t){console.log(e)});i.onSubmit=function(){i.formError="";if(!i.formData||!i.formData.title||!i.formData.content||!i.formData.category_id||!i.formData.tags){i.formError="All fields required, please try again"}else{r.addArticle({title:i.formData.title,content:i.formData.content,category_id:i.formData.category_id,tags:i.formData.tags}).success(function(e){console.log("success");o.path("/")}).error(function(e){i.formError="Your article has not been saved,there is an error, try again"});console.log(i.formData);return false}}}else{o.path("/login");console.log("Please sign in first")}}})();(function(){angular.module("yboxApp").controller("registerCtrl",e);e.$inject=["$location","authentication","$rootScope"];function e(e,t,r){var o=this;o.credentials={name:"",email:"",password:""};o.returnPage=e.search().page||"/";o.onSubmit=function(){o.formError="";if(!o.credentials.name||!o.credentials.email||!o.credentials.password){o.formError="All fields required, please try again";return false}else{o.doRegister()}};o.doRegister=function(){o.isSubmitted=true;o.message="Please wait....";o.formError="";t.register(o.credentials).error(function(e){o.formError=e.message}).then(function(){e.search("page",null);e.path(o.returnPage);r.isLoggedIn=t.isLoggedIn();r.currentUser=t.currentUser()})}}})();(function(){angular.module("yboxApp").controller("loginCtrl",e);e.$inject=["$location","authentication","$rootScope"];function e(e,t,r){var o=this;o.credentials={email:"",password:""};o.returnPage=e.search().page||"/";o.onSubmit=function(){o.formError="";if(!o.credentials.email||!o.credentials.password){o.formError="All fields required, please try again";return false}else{o.doLogin()}};o.doLogin=function(){o.isSubmitted=true;o.message="Please wait....";o.formError="";t.login(o.credentials).error(function(e){o.formError=e.message}).then(function(){r.isLoggedIn=t.isLoggedIn();e.search("page",null);r.currentUser=t.currentUser();e.path(o.returnPage)})}}})();(function(){angular.module("yboxApp").controller("bodyCtrl",e);e.$inject=["categories","$rootScope"];function e(e,t){t.categories=[];e.getAll().success(function(e){t.categories=e}).error(function(e){console.log(e)})}})();