(function(){angular.module("yboxApp",["ngRoute","ngSanitize"]);function e(e,t){e.when("/",{templateUrl:"/views/home.view.html",controller:"homeCtrl",controllerAs:"vm"}).when("/article/:articleid",{templateUrl:"/views/articleDetail.view.html",controller:"articleDetailCtrl",controllerAs:"vm"}).when("/category/:categoryid/articles",{templateUrl:"/views/home.view.html",controller:"categoryArticles",controllerAs:"vm"}).when("/newarticle",{templateUrl:"/views/newarticle.view.html",controller:"newArticleCtrl",controllerAs:"vm"}).when("/register",{templateUrl:"/views/register.view.html",controller:"registerCtrl",controllerAs:"vm"}).when("/login",{templateUrl:"/views/login.view.html",controller:"loginCtrl",controllerAs:"vm"}).otherwise({redirectTo:"/"});t.html5Mode(true)}angular.module("yboxApp").config(["$routeProvider","$locationProvider",e])})();(function(){angular.module("yboxApp").controller("homeCtrl",e);e.$inject=["articles","$routeParams"];function e(e,t){var r=this;r.rightContent="Feature and Advertising posts goes here";r.message="Loading article";var o=1;if(t.page){o=t.page}var n=5;r.link="/";e.getAll(n,o).success(function(e){r.message=e.length>0?"":"No articles found";r.data={articles:e}}).error(function(e){r.message="Sorry, something's gone wrong"});e.getArticlesNumber("").success(function(e){r.pages=[];var t=Math.ceil(e/n);for(var o=1;o<=t;o++){r.pages.push(o)}}).error(function(e){console.log(e)})}})();(function(){angular.module("yboxApp").service("articles",e);e.$inject=["$http","authentication"];function e(e,t){this.getAll=function(t,r){return e.get("/api/articles?limit="+t+"&page="+r)};this.addArticle=function(r){return e.post("/api/articles",r,{headers:{Authorization:"Bearer "+t.getToken()}})};this.getArticleById=function(t){return e.get("/api/articles/"+t)};this.getArticlesNumber=function(t){return e.get("/api/articlescount?category_id="+t)}}})();(function(){angular.module("yboxApp").service("categories",e);e.$inject=["$http"];function e(e){this.getAll=function(){return e.get("/api/categories")};this.articles=function(t,r,o){return e.get("/api/categories/"+t+"/articles?limit="+r+"&page="+o)};this.getArticlesNumber=function(t){return e.get("/api/articlescount?category_id="+t)}}})();(function(){angular.module("yboxApp").service("authentication",e);e.$inject=["$window","$http"];function e(e,t){var r=function(t){e.localStorage["ybox-token"]=t};this.saveToken=r;var o=function(){return e.localStorage["ybox-token"]};this.getToken=o;this.register=function(e){return t.post("/api/register",e).success(function(e){r(e.token)})};this.login=function(e){return t.post("/api/login",e).success(function(e){r(e.token)})};this.logout=function(){e.localStorage.removeItem("ybox-token")};var n=function(){var t=o();if(t){var r=JSON.parse(e.atob(t.split(".")[1]));return r.exp>Date.now()/1e3}else{return false}};this.isLoggedIn=n;this.currentUser=function(){if(n()){var t=this.getToken();var r=JSON.parse(e.atob(t.split(".")[1]));return{email:r.email,name:r.name}}}}})();(function(){angular.module("yboxApp").directive("footerGeneric",e);function e(){return{restrict:"EA",templateUrl:"/common/directives/footerGeneric/footerGeneric.template.html"}}})();(function(){angular.module("yboxApp").directive("navigation",e);function e(){return{restrict:"EA",templateUrl:"/common/directives/navigation/navigation.template.html",controller:"navigationCtrl as navvm"}}})();(function(){angular.module("yboxApp").controller("navigationCtrl",e);e.$inject=["$location","authentication"];function e(e,t){var r=this;r.currentPath=e.path();r.isLoggedIn=t.isLoggedIn();r.currentUser=t.currentUser();r.logout=function(){t.logout();e.path("/")}}})();(function(){angular.module("yboxApp").directive("pageHeader",e);function e(){return{restrict:"EA",scope:{data:"=content"},templateUrl:"/common/directives/pageHeader/pageHeader.template.html"}}})();(function(){angular.module("yboxApp").controller("articleDetailCtrl",t);t.$inject=["$routeParams","articles"];function t(t,r){var o=this;o.articleid=t.articleid;r.getArticleById(o.articleid).success(function(e){o.article=e}).error(function(t){console.log(e)});r.getAll(4,1).success(function(e){o.relatedArticles=e.filter(function(e){return e._id!=o.articleid})}).error(function(t){console.log(e)})}})();(function(){angular.module("yboxApp").controller("categoryArticles",e);e.$inject=["categories","$routeParams"];function e(e,t){var r=this;r.rightContent="Feature and Advertising posts goes here";r.message="Loading article";var o=t.categoryid;r.articles=[];var n=5;var i=1;r.link="/category/"+o+"/articles";if(t.page){i=t.page}e.getArticlesNumber(o).success(function(e){r.pages=[];var t=Math.ceil(e/n);for(var o=1;o<=t;o++){r.pages.push(o)}}).error(function(e){console.log(e)});e.articles(o,n,i).success(function(e){r.message=e.length>0?"":"No articles found";r.data={articles:e}}).error(function(e){r.message="Sorry, something's gone wrong"})}})();(function(){angular.module("yboxApp").controller("newArticleCtrl",t);t.$inject=["categories","articles","$location"];function t(t,r,o){var n=this;t.getAll().success(function(e){n.categories=e}).error(function(t){console.log(e)});n.onSubmit=function(){n.formError="";if(!n.formData||!n.formData.title||!n.formData.content||!n.formData.category_id||!n.formData.tags){n.formError="All fields required, please try again"}else{r.addArticle({title:n.formData.title,content:n.formData.content,category_id:n.formData.category_id,tags:n.formData.tags}).success(function(e){console.log("success");o.path("/")}).error(function(e){n.formError="Your article has not been saved,there is an error, try again"});console.log(n.formData);return false}}}})();(function(){angular.module("yboxApp").controller("registerCtrl",e);e.$inject=["$location","authentication"];function e(e,t){var r=this;r.credentials={name:"",email:"",password:""};r.returnPage=e.search().page||"/";r.onSubmit=function(){r.formError="";if(!r.credentials.name||!r.credentials.email||!r.credentials.password){r.formError="All fields required, please try again";return false}else{r.doRegister()}};r.doRegister=function(){r.formError="";t.register(r.credentials).error(function(e){r.formError=e}).then(function(){e.search("page",null);e.path(r.returnPage)})}}})();(function(){angular.module("yboxApp").controller("loginCtrl",e);e.$inject=["$location","authentication"];function e(e,t){var r=this;r.credentials={email:"",password:""};r.returnPage=e.search().page||"/";r.onSubmit=function(){r.formError="";if(!r.credentials.email||!r.credentials.password){r.formError="All fields required, please try again";return false}else{r.doLogin()}};r.doLogin=function(){r.formError="";t.login(r.credentials).error(function(e){r.formError=e}).then(function(){e.search("page",null);e.path(r.returnPage)})}}})();(function(){angular.module("yboxApp").controller("bodyCtrl",e);e.$inject=["categories","$rootScope"];function e(e,t){t.categories=[];e.getAll().success(function(e){t.categories=e}).error(function(e){console.log(e)})}})();